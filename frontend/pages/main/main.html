    
<script src="../../alpine.min.js" defer></script>
<script src="../../jquery.min.js" defer></script>
<script src="../../common.js" ></script>

<link rel="stylesheet" href="./main.css">
<div id="root" x-data="{ error: null, amount: 0, amountCost: 0}">
    <h1>Ксюкулятор</h1>
    <nav>
        <a href="/frontend/pages/main/main.html" class="link" >Калькулятор</a>
        <a href="/frontend/pages/categories/categories.html" class="link">Категории</a>
    </nav>
    <span id="error" x-show="!!error" x-text="error" class="error"></span>

    <div class="row">
        <div class="column">
            <h3>Продукты</h3>
            <div class="overflow_container">
                <table id="productsTable">
                    <thead>
                        <tr>
                            <td>Название продукта</td>
                            <td>Количество углеводов, г / 100 г продукта</td>
                            <td>Название категории</td>
                            <td>Контроль</td>
                        </tr>
                    </thead>
                    <tbody>
        
                    </tbody>
                    
                </table>
            </div>
        </div>
        <div id="controlButtons">
            <h3>Контроль продуктов</h3>
            
            <button @click="await parseProducts()" class="button">Обновить список</button>
            <a href="/frontend/pages/addProduct/addProduct.html/" class="button">
                Добавить продукт
            </a>
            <!--button @click="await delProduct(1)" class="button">Удалить продукт</button-->
            


            <!--a href="/frontend/pages/addProduct/addProduct.html" class="button">Добавить продукт</a-->
        </div>
    </div>
    <div class="row">
        <div class="column">
            <h3>Продукты на расчёт</h3>

            <div class="overflow_container">
                <table id="amountsTable">
                    <thead>
                        <tr>
                            <td>Название продукта</td>
                            <td>Количество продукта, г</td>
                            <td>Стоимость количества продукта, х.е.</td>
                            <td>Контроль</td>
                        </tr>
                    </thead>
                    <tbody>
        
                    </tbody>
                    
                </table>
            </div>
            <span>
                ИТОГО: <span id="sum">0</span> хлебных единиц
            </span>
        </div>
        <div id="calculateControllers">
            <h3>Контроль расчёта продуктов</h3>
            <span>Выбрать тип расчёта</span>
            <label for="#amount">Количество продукта, г</label>
            <input type="number" id="amount" x-model="amount" disabled>
            <button @click="selectCalcType('calcAmountCost')">Расчитать стоимость в хлебных единицах</button>
            <label for="#amountCost">Количество хлебных единиц, х.е.</label>
            <input type="number" id="amountCost" x-model="amountCost">
            <button @click="selectCalcType('calcAmount')">Рассчитать количество продукта</button>

        </div>
    </div>
    
</div>

<script> 
    async function delProduct(idProduct) {
        try {
            let result = await deleteProduct(idProduct)
            if (result) await parseProducts()
        }
        catch (e) {
            error = e
        }
        
    }
    async function calculate(idProduct) {
        let summ = await addAmountToCalc(parseInt(idProduct), 
            parseFloat($("#amount").val()), parseFloat( $("#amountCost").val()))
        await parseProductsAmounts()
        $("#sum").text(summ)
    }

    async function removeFromCalc(idProduct) {
        let summ = await deleteAmountFromCalc(parseInt(idProduct))
        await parseProductsAmounts()
        $("#sum").text(summ)
    }

    function selectCalcType(stringValue) {
        if (stringValue === 'calcAmount') {
            amount = 0
            $("#amount").val(0)
            $("#amountCost").prop("disabled", false)
            $("#amount").prop("disabled", true)
        } else if (stringValue === 'calcAmountCost') {
            amountCost = 0
            $("#amountCost").val(0)
            $("#amountCost").prop("disabled", true)
            $("#amount").prop("disabled", false)
        }
    }
    parseProducts()
    parseProductsAmounts()
</script>


